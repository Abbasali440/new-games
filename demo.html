<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Breakout - Multi Ball</title>
<style>
  :root{
    --bg:#071021;
    --panel:#0b1220;
    --accent:#06b6d4;
    --brick1:#ef4444;
    --brick2:#f59e0b;
    --brick3:#22c55e;
    --muted:#94a3b8;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg,var(--bg),#02121a);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",sans-serif;
    color:white;
    padding:12px;
  }
  .wrap{width:90vmin; max-width:700px; margin:auto; text-align:center;}
  canvas{
    width:100%;
    height:auto;
    background:linear-gradient(180deg,#021827,#072034);
    border-radius:12px;
    box-shadow:0 12px 40px rgba(0,0,0,0.6);
    display:block;
    margin:0 auto;
  }
  .hud{display:flex;gap:12px;justify-content:center;align-items:center;margin-top:10px;flex-wrap:wrap}
  .badge{background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;font-weight:600;color:var(--muted)}
  button{
    padding:8px 12px;border-radius:10px;border:0;background:var(--accent);color:#012;cursor:pointer;font-weight:700
  }
  .controls-note{font-size:13px;color:var(--muted);margin-top:8px}
  @media (max-width:420px){
    .hud{gap:8px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h2 style="margin:8px 0 6px">Breakout â€” Multi Ball</h2>
    <canvas id="game" width="720" height="480"></canvas>

    <div class="hud">
      <div class="badge">Score: <span id="score">0</span></div>
      <div class="badge">Lives: <span id="lives">3</span></div>
      <div class="badge">High: <span id="high">0</span></div>
      <button id="pauseBtn">Pause</button>
      <button id="restartBtn">Restart</button>
    </div>
    <div class="controls-note">
      Mobile: Touch & drag paddle. Tap = Launch / Add Ball.<br>
      Desktop: Mouse / Arrows, Space = Extra Ball.
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const livesEl = document.getElementById('lives');
  const highEl = document.getElementById('high');
  const pauseBtn = document.getElementById('pauseBtn');
  const restartBtn = document.getElementById('restartBtn');

  const W = canvas.width;
  const H = canvas.height;

  let paddle, bricks, rows = 5, cols = 10, brickW, brickH = 18, padding = 8;
  let balls = [];
  let score = 0, lives = 3, high = 0;
  let running = true, launched = false;

  try { high = parseInt(localStorage.getItem('breakout_high')) || 0; } catch(e){ high = 0; }
  highEl.textContent = high;

  function resetLevel(){
    paddle = { w: W * 0.16, h: 14, x: (W - W*0.16)/2, y: H - 50, speed: 10 };
    balls = [{ r: 8, x: W/2, y: paddle.y - 18, vx: 0, vy: 0 }];
    brickW = (W - padding*(cols+1)) / cols;
    bricks = [];
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        bricks.push({
          x: padding + c*(brickW + padding),
          y: 60 + r*(brickH + padding),
          w: brickW,
          h: brickH,
          alive: true,
          hits: 1 + Math.floor(r/2)
        });
      }
    }
    launched = false;
    updateHUD();
  }

  function updateHUD(){
    scoreEl.textContent = score;
    livesEl.textContent = lives;
    highEl.textContent = high;
  }

  function drawRoundedRect(x,y,w,h,r=6){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
    ctx.fill();
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#071827'); g.addColorStop(1,'#02121a');
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

    for(const b of bricks){
      if(!b.alive) continue;
      ctx.fillStyle = (b.hits===1)?getCSS('--brick1'):(b.hits===2?getCSS('--brick2'):getCSS('--brick3'));
      drawRoundedRect(b.x, b.y, b.w, b.h, 6);
    }

    ctx.fillStyle = '#06b6d4';
    drawRoundedRect(paddle.x, paddle.y, paddle.w, paddle.h, 8);

    ctx.fillStyle = '#fff';
    balls.forEach(ball=>{
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
      ctx.fill();
    });
  }

  function getCSS(v){ return getComputedStyle(document.documentElement).getPropertyValue(v); }
  function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

  function step(){
    if(!running) return;

    if(launched){
      balls.forEach((ball,i)=>{
        ball.x += ball.vx; ball.y += ball.vy;

        // walls
        if(ball.x-ball.r<=0||ball.x+ball.r>=W) ball.vx*=-1;
        if(ball.y-ball.r<=0) ball.vy*=-1;

        // paddle
        if(ball.y+ball.r>=paddle.y && ball.y+ball.r<=paddle.y+paddle.h &&
           ball.x>=paddle.x && ball.x<=paddle.x+paddle.w){
          const hitPos=(ball.x-(paddle.x+paddle.w/2))/(paddle.w/2);
          const sp=Math.hypot(ball.vx,ball.vy);
          const angle=hitPos*(Math.PI/3);
          ball.vx=sp*Math.sin(angle);
          ball.vy=-Math.abs(sp*Math.cos(angle));
          ball.y=paddle.y-ball.r-0.1;
        }

        // bricks
        for(const b of bricks){
          if(!b.alive) continue;
          if(circleRectCollision(ball,b)){
            ball.vy*=-1;
            b.hits--; score+= (b.hits<=0)?10:5;
            if(b.hits<=0) b.alive=false;
            updateHUD();
            break;
          }
        }

        // lost ball
        if(ball.y-ball.r>H){
          balls.splice(i,1);
          if(balls.length===0){
            lives--;
            if(lives<=0){
              running=false;
              if(score>high){ high=score; localStorage.setItem('breakout_high',high); }
              updateHUD();
              setTimeout(()=>alert("Game Over! Score: "+score),100);
              return;
            } else {
              launched=false;
              balls=[{r:8,x:paddle.x+paddle.w/2,y:paddle.y-18,vx:0,vy:0}];
            }
          }
        }
      });

      if(bricks.every(b=>!b.alive)){
        rows=Math.min(8,rows+1); lives=Math.min(5,lives+1);
        resetLevel();
      }
    } else {
      balls[0].x=paddle.x+paddle.w/2;
      balls[0].y=paddle.y-18;
    }

    draw();
    requestAnimationFrame(step);
  }

  function circleRectCollision(circle, rect){
    const cx=circle.x,cy=circle.y,r=circle.r;
    const rx=rect.x,ry=rect.y,rw=rect.w,rh=rect.h;
    const closestX=clamp(cx,rx,rx+rw);
    const closestY=clamp(cy,ry,rh+ry);
    const dx=cx-closestX,dy=cy-closestY;
    return dx*dx+dy*dy<=r*r;
  }

  // controls
  canvas.addEventListener('mousemove',e=>{
    const rect=canvas.getBoundingClientRect();
    const px=(e.clientX-rect.left)*(W/rect.width);
    paddle.x=clamp(px-paddle.w/2,0,W-paddle.w);
  });
  canvas.addEventListener('touchmove',e=>{
    const t=e.touches[0]; const rect=canvas.getBoundingClientRect();
    const px=(t.clientX-rect.left)*(W/rect.width);
    paddle.x=clamp(px-paddle.w/2,0,W-paddle.w);
  },{passive:true});

  // launch or add ball
  function addBall(){
    if(!launched){
      launched=true;
      const sp=5, angle=(-Math.PI/4)+(Math.random()*Math.PI/2);
      balls[0].vx=Math.cos(angle)*sp;
      balls[0].vy=-Math.abs(Math.sin(angle)*sp);
    } else {
      balls.push({r:8,x:paddle.x+paddle.w/2,y:paddle.y-18,
                  vx:(Math.random()>0.5?3:-3),vy:-4});
    }
  }
  canvas.addEventListener('click',addBall);
  canvas.addEventListener('touchend',addBall,{passive:true});
  window.addEventListener('keydown',e=>{
    if(e.key===" "||e.code==="Space"){e.preventDefault();addBall();}
    if(e.key==="ArrowLeft") paddle.x=clamp(paddle.x-30,0,W-paddle.w);
    if(e.key==="ArrowRight") paddle.x=clamp(paddle.x+30,0,W-paddle.w);
  });

  // pause & restart
  pauseBtn.addEventListener('click',()=>{running=!running;pauseBtn.textContent=running?'Pause':'Resume';if(running)requestAnimationFrame(step);});
  restartBtn.addEventListener('click',()=>{if(confirm('Restart?')){rows=5;score=0;lives=3;resetLevel();running=true;}});

  resetLevel();
  requestAnimationFrame(step);
})();
</script>
</body>
</html>
